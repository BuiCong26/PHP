<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/css/manage-header.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/toastr.min.css"/>
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
<div class="container-fluid">
    <div class="row flex-nowrap">
        <div id="demo" class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark">
            <div class="text-white d-flex p-4">
                <a href="/"><i class="fa-solid fa-house me-3"></i></a>
                <h4>Manage</h4>
            </div>
            <hr class="text-gray">
            <div class="d-flex flex-column justify-content-between px-3 pt-2 text-white min-vh-100">
                <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <button class="nav-link" id="v-pills-store-tab" data-bs-toggle="pill" data-bs-target="#v-pills-care" type="button" role="tab" aria-controls="v-pills-care" aria-selected="true">Chăm sóc khách hàng</button>
                    <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#v-pills-store" type="button" role="tab" aria-controls="v-pills-store" aria-selected="true">Sản phẩm</button>
                    <button class="nav-link" id="v-pills-order-tab" data-bs-toggle="pill" data-bs-target="#v-pills-order" type="button" role="tab" aria-controls="v-pills-order" aria-selected="false">Hóa đơn</button>
                </div>
                <div class="dropdown pb-4">
                    <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                        <span class="d-none d-sm-inline mx-1">{{Auth::user()->email}}</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
                        <li><a class="dropdown-item" href="#">Thêm sản phẩm</a></li>
                        @if(Auth::user()->role == 0)
                           <li><a class="dropdown-item" href="#">Quản lý tài khoản</a></li>
                        @endif
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="/logout">Đăng xuất</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col py-3">
            <div class="d-flex justify-content-between">
                <button class="btn border-0 outline-0" data-bs-toggle="collapse" data-bs-target="#demo"><i class="fa-solid fa-bars fs-4"></i></button>
                <div>
                    <a href="/"><i class="fa-solid fa-house me-2"></i>Trang chủ</a>
                    <a href="/logout">
                        <i class="fa-solid fa-arrow-right-from-bracket ms-4"></i>
                    </a>
                </div>
            </div>
            <div class="tab-content p-4" id="v-pills-tabContent">
                <div class="tab-pane fade show active" id="v-pills-store" role="tabpanel" aria-labelledby="v-pills-store-tab">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="product-tab" data-bs-toggle="tab" data-bs-target="#product" type="button" role="tab" aria-controls="product" aria-selected="true">Sản phẩm</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="category-tab" data-bs-toggle="tab" data-bs-target="#category" type="button" role="tab" aria-controls="category" aria-selected="false">Danh mục sản phẩm</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="combo-tab" data-bs-toggle="tab" data-bs-target="#combo" type="button" role="tab" aria-controls="combo" aria-selected="false">Combo</button>
                        </li>
                    </ul>
                    <div class="tab-content mt-5" id="myTabContent">
                        <div class="tab-pane fade show active" id="product" role="tabpanel" aria-labelledby="product-tab">
                            <div style="width: 200px" data-bs-toggle="modal" data-bs-target="#modalUploadProduct" class="cursor-pointer bg-gray rounded-3">
                                <div data-bs-toggle="tooltip" data-bs-target="Thêm sp" class="card-bg-image d-flex align-items-center justify-content-center"
                                     style="background-image: url('https://endlessicons.com/wp-content/uploads/2012/12/add-icon-614x460.png'); "></div>
                            </div>
                            <div class="mt-4">
                                <h1>Sản phẩm</h1>
                                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                                    <div class="container-fluid">
                                        <a class="navbar-brand" href="#">Bộ lọc</a>
                                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                            <span class="navbar-toggler-icon"></span>
                                        </button>
                                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                                                <li class="nav-item dropdown">
                                                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        Giảm giá
                                                    </a>
                                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                        <li><a class="dropdown-item" href="?orderBy=hightprice">Tăng</a></li>
                                                        <li><a class="dropdown-item" href="?orderBy=lowprice">Giảm</a></li>
                                                    </ul>
                                                </li>
                                                <li class="nav-item dropdown">
                                                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                        Nhãn hiệu
                                                    </a>
                                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                                <li data-value="{{$trademark['id']}}" class="d-flex align-items-center cursor-pointer dropdown-item w-100 mx-2 my-2 rounded-3 w-100">
                                                                    <img src="{{$trademark['icon_url']}}" alt="" class="logo">
                                                                    <a data-value="{{$trademark['id']}}" class="flex-fill mx-2 rounded-10 w-auto">{{$trademark['name']}}</a>
                                                                </li>
                                                        @endif
                                                    </ul>
                                                </li>
                                            </ul>
                                            <form class="d-flex">
                                                <input class="form-control me-2" type="search" placeholder="Tìm kiếm theo tên" aria-label="Search">
                                                <button class="btn btn-outline-success" type="submit">Search</button>
                                            </form>
                                        </div>
                                    </div>
                                </nav>
                                <div>
                                    <table class="table">
                                        <tr>
                                            <th>Hình đại diện</th>
                                            <th>Tên SP</th>
                                            <th>Giá</th>
                                            <th>Trạng thái</th>
                                            <th><i class="fa-solid fa-gear"></i></th>
                                        </tr>
                                        @foreach($products['data'] as $product)
                                            <tr>
                                                <td><img style="width: 100px" src="{{$product['first_image']}}" alt=""></td>
                                                <td>{{$product['name']}}</td>
                                                <td>{{ number_format($product['price'], 0, '', ',') }}d</td>
                                                <td>@if($product['status'] == 'published')
                                                        <i class="fas fa-eye text-success"></i>
                                                    @else
                                                        <i class="fas fa-eye-slash text-danger"></i>
                                                    @endif
                                                </td>
                                                <td>
                                                    <button data-bs-toggle="modal" data-bs-target="#modalUploadProduct" onclick="product.edit({{$product['id']}})" class="btn bg-gray btn-sm text-black"><i class="fas fa-edit"></i></button>
                                                    <button onclick="product.remove({{$product['id']}})" class="btn bg-danger btn-sm text-white"><i class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        @endforeach
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="category" role="tabpanel" aria-labelledby="category-tab">
                            <div style="width: 200px" data-bs-toggle="modal" data-bs-target="#modalUploadProductCategory" class="cursor-pointer bg-gray rounded-3">
                                <div data-bs-toggle="tooltip" data-bs-target="Thêm sp" class="card-bg-image d-flex align-items-center justify-content-center"
                                     style="background-image: url('https://endlessicons.com/wp-content/uploads/2012/12/add-icon-614x460.png')"></div>
                            </div>
                            <div class="mt-4">
                                <h1>Danh mục</h1>
                                <div>
                                    <table class="table">
                                        <tr>
                                            <th>Hình đại diện</th>
                                            <th>Tên danh mục</th>
                                            <th><i class="fa-solid fa-gear"></i></th>
                                        </tr>
                                        @foreach($categories['data'] as $category)
                                            <tr>
                                                <td><img style="width: 100px" src="{{$category['image_url']}}" alt=""></td>
                                                <td>{{$category['name']}}</td>
                                                <td>
                                                    <button data-bs-toggle="modal" data-bs-target="#modalUploadProduct" onclick="product.edit({{$product['id']}})" class="btn bg-gray btn-sm text-black"><i class="fas fa-edit"></i></button>
                                                    <button onclick="product.remove({{$product['id']}})" class="btn bg-danger btn-sm text-white"><i class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        @endforeach
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="combo" role="tabpanel" aria-labelledby="combo-tab">
                            <div style="width: 200px" data-bs-toggle="modal" data-bs-target="#modalUploadCombo" class="cursor-pointer bg-gray rounded-3">
                                <div data-bs-toggle="tooltip" data-bs-target="Thêm combo" class="card-bg-image d-flex align-items-center justify-content-center"
                                     style="background-image: url('https://endlessicons.com/wp-content/uploads/2012/12/add-icon-614x460.png')"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="v-pills-care" role="tabpanel" aria-labelledby="v-pills-statistical-tab">
                    <h1>Yêu cầu</h1>
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Tên</th>
                            <th scope="col">SĐT</th>
                            <th scope="col">Thời gian tạo</th>
                            <th scope="col">Trạng thái</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>08921331231<i class="fa-regular fa-copy ms-2 cursor-pointer" onclick="copyToClipboard('08921331231')"></i></td>
                            <td>12:12:12 8/8/2022</td>
                            <td><span class="text-danger">Không gọi được</span></td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>08921331231</td>
                            <td>12:12:12 8/8/2022</td>
                            <td><span class="text-success">Đã tư vấn</span></td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td>Minh</td>
                            <td>08921331231</td>
                            <td>12:12:12 8/8/2022</td>
                            <td><span class="text-warning">Đang chờ</span></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane fade" id="v-pills-order" role="tabpanel" aria-labelledby="v-pills-order-tab">
                    <table class="table table-striped">
                        <tbody>
                        <tr>
                            <th>Mã HĐ</th>
                            <th>SĐT khách hàng</th>
                            <th>Thời gian đặt</th>
                            <th>Trạng thái</th>
                            <th></th>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

</body>

<script type="text/javascript" src="/js/app.js" defer></script>
<script type="text/javascript" src="/js/axios.min.js"></script>
<script type="text/javascript" src="/js/jquery.slim.min.js"></script>
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/sweet-alert.js"></script>
<script type="text/javascript" src="/js/jquery.validate.min.js"></script>
<script>
    function showImageFromUrl(e){
        const self = $(e.currentTarget);
        const print = $(self).closest('.box').find('print')[0];
        $(print).html(`<img src="${self.val()}" class='w-100'>`)
    }
    const product = {
        validate: (data)=>{
            let valid = true;
            console.log($("#formUploadProduct .required").length)
            $.each($("#formUploadProduct .required"), function (){
                if($(this).val() == "" || $(this).val() == null){
                    $(this).focus();
                    valid = false;
                }
            })
            return valid
        },
        getData: ()=>{
            //dung ham serializeArray để lấy tất cả data của input theo trường name của chúng trong formUploadProduct
            var data = $('#formUploadProduct').serializeArray().reduce(function(obj, item) {
                obj[item.name] = item.value;
                return obj;
            }, {});

            //lấy thông số sản phẩm
            data.items = [];
            const productItems = $(".product-item");
            $.each(productItems, function (index,elem){
                let item = {};
                item.type = $(elem).data('type');
                const color = $(elem).find('input.color');
                if (color.length){
                    $.each(color, function (){
                        item[$(this).data('type')]=$(this).val();
                    })
                } else {
                    item.value = $(elem).val();
                }
                (data.items).push(item)
            })

            //giam gia
            if(($("#productValueDiscount").val()).length){
                data.discount = {};
                data.discount.type = $("#productTypeDiscount").data('type');
                data.discount.value = $("#productValueDiscount").val();
            }
            //type
            data.type = $("#productType").data('type');

            //category
            data.product_category_id = $("#categoryproduct").data('value')
            return data;
        },

        create: ()=>{
            const data = product.getData();
            const validate = product.validate(data);
            if (!validate){
                quickToastMixin('error','Vui lòng không bỏ trống các trường được đánh dấu')
                return;
            }
            axios.post(`/api/auth-web/product/create`, data)
            .then((r)=>{
                console.log(r);
                quickToastMixin('success','Đã tạo sản phẩm')
            })
            .catch((e)=>{4
                console.log(e)
                quickToastMixin('error', 'error')
            })
        },
        fetch:(id,callback)=>{
            axios.get(`/api/auth-web/product/${id}`)
            .then((r)=>{
                callback(r.data.data)
            })
            .catch(e=>{

            })
        },
        edit: (id)=>{
            const data = product.fetch(id, function (data){
                product.settingModalEdit(data)
            });
        },
        settingModalEdit: (d)=>{
            const f = document.getElementById("formUploadProduct");
            f.first_image.value = d.first_image;
            f.second_image.value = d.second_image??"";
            f.third_image.value = d.third_image ?? "";
            f.name.value = d.name??"";
            f.description.value = d.description??"";
            f.price.value = d.price??"";
            f.productValueDiscount.value = d.productValueDiscount??"";
            f.memory.value = d.memory??"";
            f.ram.value = d.ram??"";
            f.display.value = d.display??"";
            f.camera.value = d.camera??"";
        },
        genColorInput: ()=>{
            return `<div class="px-4 product-item" data-type="color">
                                <span class="text-gray">Thêm màu sắc</span>
                                <input data-type="name" class="name color form-control my-2" type="text" placeholder="Tên màu">
                                <input data-type="value" class="value color form-control my-2" type="text" placeholder="Mã màu">
                                <input data-type="image" class="image color form-control my-2" type="text" placeholder="URL Hình ảnh minh họa">
                                <input data-type="price_value_fixed" class="price-fixed color form-control my-2" type="text" placeholder="Mức giá thay đổi">
                            </div>`
        },

        duplicate: (print, callback) =>{
            $(print).append(callback())
        },
        remove:(id)=>{
            axios.delete('/api/auth-web/product/'+id)
            .then(()=>{
                quickToastMixin('success','Đã xóa sản phẩm')
            })
            .catch(e=>{

            })
        }
    }

    const productCategory = {
        getData:()=>{
            var data = $('#formUploadProductCategory').serializeArray().reduce(function(obj, item) {
                obj[item.name] = item.value;
                return obj;
            }, {});

            data.trademark_id = $("#trademarkProduct").data('value')
            return data
        },
        create: ()=>{
            const data = productCategory.getData();
            console.log(data)
            axios.post(`/api/auth-web/createCategory`,data)
            .then(r=>{
                console.log(r.data)
            })
            .catch(e=>{
                quickToastMixin('error','loi')
            })
        }
    }
</script>
</html>
